# FREE Tier Single-Service Render Deployment for StudyMateAI
# Uses only FREE features - No payment required!
# ONE URL for entire application

services:
  # Single FREE Service - Spring Boot serving both API and Frontend
  - type: web
    name: studymate-app
    plan: free
    buildCommand: |
      # Build frontend first
      cd frontend && npm install && npm run build
      # Copy frontend to backend static resources
      mkdir -p backend/src/main/resources/static
      cp -r frontend/build/* backend/src/main/resources/static/
      # Build backend with embedded frontend
      cd backend && mvn clean package -DskipTests
    startCommand: java $JAVA_OPTS -Dserver.port=$PORT -jar backend/target/*.jar
    healthCheckPath: /api/actuator/health
    autoDeploy: true
    envVars:
      - key: PORT
        value: 10000
      - key: JAVA_OPTS
        value: "-Xmx400m -XX:+UseContainerSupport -XX:+UseG1GC"
      - key: SPRING_PROFILES_ACTIVE
        value: production
      - key: SPRING_DATASOURCE_URL
        value: "jdbc:postgresql://aws-0-ap-south-1.pooler.supabase.com:5432/postgres"
      - key: SPRING_DATASOURCE_USERNAME
        value: "postgres.vfhswjfjwqjmpcxjgedc"
      - key: SPRING_DATASOURCE_PASSWORD
        value: "ahtasham2105067"
      - key: JWT_SECRET
        value: "studymate-free-jwt-secret-key-2024-render-single-url"
      - key: JWT_EXPIRATION
        value: "86400000"
      - key: GEMINI_API_KEY
        value: "AIzaSyA2DsN6bTwwuySdLO-VkPwuaKBW19ShbSk"
      - key: GEMINI_API_URL
        value: "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent"
      - key: SPRING_JPA_HIBERNATE_DDL_AUTO
        value: "update"
      - key: SPRING_JPA_SHOW_SQL
        value: "false"
      - key: CORS_ALLOWED_ORIGINS
        value: "*"
      - key: FILE_UPLOAD_DIR
        value: "/tmp/uploads"
      - key: MAX_FILE_SIZE
        value: "10MB"
      - key: MAX_REQUEST_SIZE
        value: "10MB"

# FREE Tier Single URL Deployment
# üåê Complete App: https://studymate-app.onrender.com
# üì± Frontend: https://studymate-app.onrender.com/ (React UI)
# üîå Backend API: https://studymate-app.onrender.com/api/ (Spring Boot)
# üîÑ WebSocket: wss://studymate-app.onrender.com/api/ws/ (Real-time)
# üìä Health: https://studymate-app.onrender.com/api/actuator/health
#
# ‚úÖ FREE Tier Features Used:
# - Auto-detected Java runtime (FREE)
# - 750 hours/month (FREE)
# - Single service (saves resources)
# - No runtime specified (auto-detection)
# - Embedded frontend in Spring Boot
# - Supabase database (already free)
#
# ‚ö†Ô∏è FREE Tier Limitations:
# - Service sleeps after 15 minutes of inactivity
# - Cold start delay (30-60 seconds)
# - File uploads to /tmp (ephemeral storage)
# - 512MB RAM limit
# - No custom domains